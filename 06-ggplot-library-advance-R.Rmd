# GGPLOT
`ggplot2` is a powerful data visualization package in R that allows you to create a wide variety of graphs and plots. It is based on the grammar of graphics, a structured approach to constructing plots that emphasizes the mapping of data to visual attributes.

## Five key steps to ggplot 
There are 5 key steps in plotting in ggplot

1.**The Setup** - Read the data set, define x and y axis 

2. **The Labels** - Title, X and Y axis labels 

3. **The Theme** - Default, Black and White, colored etc. 

4. **The Facets** - Individual Graphs for each group in data with exactly same range

5. **The Layers or geoms** - The actual plot type - e.g Bar plot, Box plot, Violin plot etc. 

To install `ggplot`, run the below command in the console.  
```
install.packages("ggplot2")
```


## Prepare the data for plotting - Data Assessment
Invoke the libraries 
```{r echo=TRUE, error=FALSE, warning=FALSE, message=FALSE}
library(ggplot2)
library(data.table)
```

Read the data using the fread function 
```{r}
methylated_c = fread("data/R_WORKSHOP.csv", header=T, sep=",")
```

View the first five records of the data 
```{r}
head(methylated_c)
```

Look at the nature of the data 
```{r}
str(methylated_c)
```
In the data set, there are numeric variables a well as character columns. There are 15 records in the data set

Calculate the summary statistics 
```{r}
summary(methylated_c)
```

Do the data have null values?
```{r}
sum(is.na(methylated_c))
```

This data does not have any null values. 

```{r}
class(methylated_c)
```


## Plotting 
### Base set up
Before plotting the data, you need to;

- Define the graph skeleton. This is just an empty `ggplot()` function without additional arguments

- Define the aesthetics. It defines how data should be mapped to visual properties like position, color, shape, and size

- Define the labels. The labels make the visualizations informative and easy to understand for the user. 

```{r}
graph=ggplot(methylated_c, 
             aes(x=Chromosome, y=Count_in_millions))+ #graph aesthetics
  labs(x="Chromosomes", y="Cytosine count in millions", title="C distribution in A thaliana") #graph labels

print(graph)
```

- Define the type of graph - geoms. For this case, the graph is a bar graph. `geoms()` stands for 'geometric objects'. In `ggplot`, there are different types of `geoms` to define which graph is to be plotted. Some of the examples include; 

- `geom_point()` for scatter plot

- `geom_line()` for a line chart 

- `geom_density()` for a density plots

- `geom_histogram()` for histograms

- `geom_boxplot()` for box plots

- `geom_col()` for bar chart

- `geom_tile()` for heat maps

In this course we shall explore a few of them but the concepts applies to all of them. Now lets make our plot a bar chart. `geom()` function will be added to a variable `graph` defined above to plot a bar chart. 
```{r}
graph1 = graph + geom_col() #plot a bar chart
print(graph1)
```

If you can remember our data, `methylated_c` has a column/variable "Context". In this step, the variable "Context" will be introduced to make a stacked bar chart, therefore, the C distribution in Chromosomes based on "Context" will be plotted to add some depth to the data. 
```{r}
graph2=graph1+aes(fill=Context)
print(graph2)
```

To make it a grouped bar chart, a `position` argument is introduced. 

```{r}
graph3=graph+geom_col(position="dodge")+aes(fill=Context)
print(graph3)
```

Faceted graphs - these are related data plotted separately on the same image/diagram.

The `facet_grid()` function is added to the variable `graph3` to created faceted graphs based on the variable "Context". 
```{r}
graph4=graph3+facet_grid(~Context)
print(graph4)
```

GGPlot randomly select colors to paint the graph but the biologist/statistician can use predefined colors as below.
```{r}
graph5=graph4+scale_fill_manual(values=c("brown", "blue", "red"))
print(graph5)
```

- The background color can be modified to ones aesthetic taste. The `theme()` function along with relevant arguments to make the background color of your choice, in this its light blue. 
```{r}
graph5+theme_bw(base_size=9)+theme(panel.background = element_rect(fill="lightblue"))
```

All of the above steps can be combined to come up with a decent graph from ggplot library.
```{r}
my_title = expression(paste("Cystosine distribution in ", italic("Arabidopis thaliana")))#Define the title 

graph_final = ggplot(methylated_c, aes(x=Chromosome, y=Count_in_millions))+
  labs(x="Chromosomes", title = my_title) +
  facet_grid(~Context) +
  geom_col(position="dodge")+
  aes(fill=Context)+scale_fill_manual(values = c("brown", "blue", "red"))+
  theme_bw(base_size = 9)+theme(panel.background = element_rect(fill="lightblue"))

print(graph_final)
```
The `expression` is used to combine name italics and normal fonts - this helps biologists include botanical names in charts

## Working with inbuilt iris data 
We have worked with iris data set before. In this topic we shall ask some questions and plot them on a box plot to cement our understanding in `ggplot`

- **Plot a box plot to compare the sepal length in different iris species**
```{r}
graph = ggplot(iris, aes(x=Species, y=Sepal.Length))+ # the graph skeleton
  geom_boxplot()+aes(fill=Species) # aesthetics

print(graph)
```
Virginica have higher sepal length however some virginica have less sepal length than versicolor

Violin plot will show a better distribution than box plot
```{r}
graph = ggplot(iris, aes(x=Species, y=Sepal.Length))+
  geom_violin()+aes(fill=Species)

print(graph)
```

Since some data cleaning and manipulation is required before diving deep into visualizations, a package **tidyr** is introduced. It can be installed by invoking the command below to the console.  
```
install.packages("tidyr")
```

This package is a part of the tidyverse collection designed to make data cleaning and reshaping easy. It has multiple functions for instance `gather()`, `spread()`, `pivot_wider()`, `pivot_longer()`, `separate()`, `unite()` and `fill()`. In this section we shall not dive deep to explore tidyr package but we will borrow one of its important functions, `gather()` to manipulate iris data when plotting. This function, `gather()` is used to reshape data especially from a long format to a short format.

Invoke the library
```{r echo=TRUE, error=FALSE, warning=FALSE, message=FALSE}
library(tidyr) # can be used to convert from short format to long format
```

- Convert to a long format

`gather` command is used to convert data into fewer columns. The columns from sepal length to petal width are to be merged to a single column called measurements
```{r}
#Gather from sepal length to petal width column into type and measurement column 
iris_long = gather(iris, type, measurement, Sepal.Length:Petal.Width, factor_key = TRUE)
tail(iris_long)
```

Lets plot the data to a box plot 
```{r}
graph=ggplot(iris_long, aes(x=Species,y=measurement))+
  labs(x="Species", y="Length in cm", title = "variation in Petals and Sepals of Iris Species")+
  theme(axis.text = element_text(angle=90))+
  facet_grid(~type)+
  aes(fill=Species)+
  geom_boxplot()

print(graph)
```

the same can also be plotted to a violin plot 
```{r}
graph=ggplot(iris_long, aes(x=Species,y=measurement))+
  labs(x="Species", y="Length in cm", title = "variation in Petals and Sepals of Iris Species")+
  theme(axis.text = element_text(angle=90))+
  facet_grid(~type)+
  aes(fill=Species)+
  geom_violin()

print(graph)
```


